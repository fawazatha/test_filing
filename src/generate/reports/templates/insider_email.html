<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ subject }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Email-safe utilities */
    th { white-space: nowrap !important; }
    .nowrap { white-space: nowrap !important; }
    .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }

    @media only screen and (max-width: 600px) {
      .container { width: 100% !important; }
      .content { padding: 16px !important; }
      .header-title { font-size: 20px !important; }
      .stats-grid { display: block !important; }
      .stat-item { display: block !important; margin-bottom: 12px !important; }
      table { font-size: 12px !important; }
      th, td { padding: 6px 4px !important; }
      .table-wrap { overflow-x: auto !important; }
    }
  </style>
</head>
<body style="margin:0;padding:0;background:#f8fafc;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;">
  <!-- Wrapper (email-safe centering) -->
  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="background:#f8fafc;">
    <tr>
      <td align="center" style="padding:32px 16px;">
        <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="600" class="container" style="max-width:600px;background:#ffffff;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);">
          
          <!-- Header -->
          <tr>
            <td class="content" style="padding:32px 32px 24px 32px;">
              <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%">
                <tr>
                  <td>
                    {% if logo_cid %}
                      <!-- Use the variable CID, not a hard-coded value -->
                      <img src="cid:{{ logo_cid }}" alt="Sectors" width="120" border="0" style="display:block;max-width:120px;height:auto;margin-bottom:12px;">
                    {% elif logo_uri %}
                      <!-- Optional data-URI/SVG fallback (only if you actually pass logo_uri) -->
                      <img src="{{ logo_uri }}" alt="Sectors" width="120" border="0" style="display:block;max-width:120px;height:auto;margin-bottom:12px;">
                    {% else %}
                      <div style="display:inline-block;width:40px;height:40px;background:linear-gradient(135deg,#ef4444,#f97316);border-radius:8px;margin-bottom:12px;"></div>
                    {% endif %}
                    <h1 class="header-title" style="margin:0 0 8px 0;font-size:24px;line-height:32px;font-weight:700;color:#1f2937;">
                      {{ subject }}
                    </h1>
                    <div style="margin:0 0 24px 0;color:#6b7280;font-size:16px;line-height:24px;font-weight:500;">
                      <strong>{{ window_start }}</strong> → <strong>{{ window_end }}</strong> (WIB)
                    </div>
                  </td>
                </tr>
              </table>

              <!-- Stats -->
              <div style="background:#f9fafb;border-radius:8px;padding:20px;margin-bottom:24px;">
                <div class="stats-grid" style="display:table;width:100%;">
                  <div class="stat-item" style="display:table-cell;text-align:center;padding:0 16px;">
                    <div style="font-size:24px;font-weight:700;color:#1f2937;margin-bottom:4px;">{{ totals.total_companies }}</div>
                    <div style="font-size:14px;color:#6b7280;font-weight:500;">Companies</div>
                  </div>
                  <div class="stat-item" style="display:table-cell;text-align:center;padding:0 16px;border-left:1px solid #e5e7eb;">
                    <div style="font-size:24px;font-weight:700;color:#1f2937;margin-bottom:4px;">{{ totals.total_filings }}</div>
                    <div style="font-size:14px;color:#6b7280;font-weight:500;">Filings</div>
                  </div>
                </div>
              </div>
            </td>
          </tr>

          {% if companies|length == 0 %}
          <!-- No Data -->
          <tr>
            <td class="content" style="padding:0 32px 32px 32px;">
              <div style="text-align:center;padding:40px 20px;background:#f9fafb;border-radius:8px;">
                <p style="margin:0;font-size:16px;line-height:24px;color:#6b7280;">No insider filings in the selected window.</p>
              </div>
            </td>
          </tr>

          {% else %}
          <!-- Companies -->
          {% for c in companies %}
          <tr>
            <td class="content" style="padding:0 32px 24px 32px;">
              <div style="border:1px solid #e5e7eb;border-radius:8px;overflow:hidden;margin-bottom:16px;">
                <!-- Company header -->
                <div style="padding:16px 20px;background:#f9fafb;border-bottom:1px solid #e5e7eb;">
                  <div style="font-weight:700;font-size:18px;color:#1f2937;line-height:24px;">
                    {{ c.symbol }}{% if c.company_name %} — {{ c.company_name }}{% endif %}
                  </div>
                </div>

                <!-- Table -->
                <div class="table-wrap" style="overflow-x:auto;">
                  <table role="presentation" cellpadding="0" cellspacing="0" border="0" width="100%" style="min-width:820px;border-collapse:collapse;">
                    <thead>
                      <tr style="background:#f8fafc;">
                        <th align="left"  style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Holder</th>
                        <th align="center" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Type</th>
                        <th align="right" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Price&nbsp;(IDR)</th>
                        <th align="right" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Value&nbsp;(IDR)</th>
                        <th align="right" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Amount</th>
                        <th align="right" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">%&nbsp;Tx</th>
                        <th align="center" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Time</th>
                        <th align="center" style="padding:12px 16px;font-size:12px;font-weight:600;color:#374151;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #e5e7eb;">Source</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for f in c.filings %}
                      <tr style="border-bottom:1px solid #f3f4f6;">
                        <td style="padding:16px;font-size:14px;color:#1f2937;font-weight:500;">
                          {{ f.holder_name }}{% if f.holder_ticker %}<br><span style="color:#6b7280;font-size:12px;">({{ f.holder_ticker }})</span>{% endif %}
                        </td>

                        <td align="center" style="padding:16px;">
                          {% if f.transaction_type == 'buy' %}
                            <span style="display:inline-block;padding:4px 12px;background:#dcfce7;color:#166534;font-size:12px;font-weight:700;border-radius:20px;text-transform:uppercase;">BUY</span>
                          {% else %}
                            <span style="display:inline-block;padding:4px 12px;background:#fee2e2;color:#dc2626;font-size:12px;font-weight:700;border-radius:20px;text-transform:uppercase;">SELL</span>
                          {% endif %}
                        </td>

                        <!-- Price (IDR) abbreviated -->
                        <td align="right" class="nowrap" style="padding:16px;font-size:14px;color:#1f2937;font-weight:500;">
                          {{ fmt_abbrev_idr(f.price) if f.price is not none else '—' }}
                        </td>

                        <!-- Value (IDR): green for BUY, red for SELL -->
                        <td align="right" class="nowrap" style="padding:16px;font-size:14px;font-weight:700; {% if f.transaction_type == 'buy' %}color:#166534;{% else %}color:#dc2626;{% endif %}">
                          {{ fmt_abbrev_idr(f.transaction_value) if f.transaction_value is not none else '—' }}
                        </td>

                        <!-- Amount abbreviated (shares) -->
                        <td align="right" class="nowrap" style="padding:16px;font-size:14px;font-weight:600;">
                          {{ fmt_abbrev_plain(f.amount) if f.amount is not none else '—' }}
                        </td>

                        <!-- % Tx: green for BUY, red for SELL -->
                        <td align="right" class="nowrap" style="padding:16px;font-size:14px;font-weight:600; {% if f.transaction_type == 'buy' %}color:#166534;{% else %}color:#dc2626;{% endif %}">
                          {{ f.share_percentage_transaction if f.share_percentage_transaction is not none else '—' }}
                        </td>

                        <!-- Time-only (dd/mm/yyyy hh:mm:ss) -->
                        <td align="center" class="nowrap" style="padding:16px;font-size:13px;color:#6b7280;">
                          {{ f.display_time or '—' }}
                        </td>

                        <!-- Source link -->
                        <td align="center" class="nowrap" style="padding:16px;font-size:13px;">
                          {% if f.source %}
                            <a href="{{ f.source }}" target="_blank" style="color:#2563eb;text-decoration:underline;font-weight:600;">source</a>
                          {% else %}
                            —
                          {% endif %}
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
          {% endif %}

          <!-- Footer -->
          <tr>
            <td class="content" style="padding:24px 32px 32px 32px;border-top:1px solid #f3f4f6;">
              <div style="text-align:center; font-size:12px; line-height:18px; color:#6b7280;">
                <p style="margin:0 0 8px 0;">
                  This email is from
                  <a href="https://sectors.app/" target="_blank" style="color:#9E0142; text-decoration:underline; font-weight:700;">Sectors.app</a>.
                </p>

                <p style="margin:0 0 12px 0;">
                  The information provided is for general purposes only and does not constitute financial advice.
                  Consider your own financial situation and consult with professionals before making any investment decisions.
                </p>

                <p style="margin:0 0 8px 0;">
                  <a href="https://sectors.app/privacy" target="_blank" style="color:#9E0142; text-decoration:underline;">Privacy Policy</a>
                  &nbsp;|&nbsp;
                  <a href="https://sectors.app/terms" target="_blank" style="color:#9E0142; text-decoration:underline;">Terms of Service</a>
                </p>

                <p style="margin:0 0 8px 0;">
                  If you want to unsubscribe,
                  <a href="{{ unsubscribe_url }}" target="_blank" style="color:#9E0142; text-decoration:underline;">click here</a>.
                </p>

                <p style="margin:0 0 8px 0;">
                  Need help with anything? Email us at
                  <a href="mailto:sectors@supertype.ai" style="color:#9E0142; text-decoration:underline;">sectors@supertype.ai</a>.
                </p>

                <p style="margin:0; color:#9ca3af;">
                  © 2025 Sectors.app. All rights reserved.
                </p>
              </div>
            </td>
          </tr>


        </table>
      </td>
    </tr>
  </table>
</body>
</html>
